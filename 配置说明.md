# TG查询机器人 配置说明

## 📋 环境变量配置 (.env 文件)

创建 `.env` 文件并配置以下参数：

```env
# ==================== Telegram Bot 配置 ====================

# Telegram API ID (从 https://my.telegram.org 获取)
API_ID=your_api_id

# Telegram API Hash (从 https://my.telegram.org 获取)
API_HASH=your_api_hash

# Bot Token (从 @BotFather 获取)
BOT_TOKEN=your_bot_token

# ==================== 查询 API 配置 ====================

# API 基础 URL
QUERY_API_URL=http://95.211.190.114

# API 密钥
QUERY_API_KEY=your_api_key

# ==================== 管理员配置 ====================

# 管理员用户ID（多个用逗号分隔）
ADMIN_IDS=123456789,987654321

# ==================== TRON 充值配置 ====================

# TRON 网络选择 (mainnet 或 nile)
# mainnet: 主网（真实交易）
# nile: 测试网（测试用）
TRON_NETWORK=nile

# TronGrid API Key (从 https://www.trongrid.io/ 申请)
TRON_API_KEY=your_tron_api_key

# 充值钱包地址（接收充值的波场地址）
RECHARGE_WALLET_ADDRESS=TTp4kncLGESMehLri6sumz6xh17fRi7N6U

# 订单超时时间（秒），默认1800秒（30分钟）
RECHARGE_ORDER_TIMEOUT=1800

# 最小充值金额（USDT）
RECHARGE_MIN_AMOUNT=10

# ==================== 功能开关 ====================

# 是否显示关联用户按钮 (true/false)
SHOW_RELATED_USERS=true

# 会话文件名
SESSION_NAME=bot_session
```

---

## 🔧 配置项详细说明

### 1. Telegram Bot 配置

#### API_ID 和 API_HASH
- **获取方式**: 访问 https://my.telegram.org
- **步骤**:
  1. 登录你的 Telegram 账号
  2. 进入 "API development tools"
  3. 创建应用，获取 API ID 和 API Hash

#### BOT_TOKEN
- **获取方式**: 联系 @BotFather
- **步骤**:
  1. 在 Telegram 中搜索 @BotFather
  2. 发送 `/newbot` 创建新机器人
  3. 按提示设置机器人名称和用户名
  4. 获取 Bot Token

---

### 2. 查询 API 配置

#### QUERY_API_URL
- **默认值**: `http://95.211.190.114`
- **说明**: 查询API的基础URL

#### QUERY_API_KEY
- **必填**: 是
- **说明**: API认证密钥，请联系管理员获取

---

### 3. 管理员配置

#### ADMIN_IDS
- **格式**: 用户ID，多个用逗号分隔
- **示例**: `123456789,987654321`
- **获取用户ID**: 
  1. 使用 @userinfobot 查询
  2. 或在 Bot 中查看个人中心

---

### 4. TRON 充值配置

#### TRON_NETWORK
- **可选值**:
  - `mainnet`: 主网（真实交易，需要真实TRX/USDT）
  - `nile`: 测试网（测试用，可以申请测试币）
- **推荐**: 开发测试使用 `nile`，生产环境使用 `mainnet`

#### TRON_API_KEY
- **获取方式**: 访问 https://www.trongrid.io/
- **说明**: 用于查询区块链交易记录

#### RECHARGE_WALLET_ADDRESS
- **格式**: 波场钱包地址（以T开头）
- **说明**: 用户充值将发送到这个地址
- **重要**: 请确保你拥有这个地址的私钥

#### RECHARGE_ORDER_TIMEOUT
- **单位**: 秒
- **默认**: 1800（30分钟）
- **说明**: 订单超时时间

#### RECHARGE_MIN_AMOUNT
- **单位**: USDT
- **默认**: 10
- **说明**: 最小充值金额

---

### 5. 功能开关

#### SHOW_RELATED_USERS
- **可选值**: `true` / `false`
- **说明**: 是否显示"查看关联用户"按钮

---

## 🚀 快速开始

### 1. 创建 .env 文件

```bash
cp .env.example .env
# 编辑 .env 文件，填入你的配置
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 运行机器人

```bash
python bot.py
```

---

## 🌐 Web 管理后台

机器人启动后，Web管理后台会自动运行在：

**地址**: http://localhost:5000

**功能**:
- 查看用户统计
- 管理系统配置
- 查看充值记录
- 用户余额管理

---

## 📊 数据库配置

机器人使用 SQLite 数据库，文件名：`telegram_cache.db`

**默认配置**（可在 Web 后台修改）:

| 配置项 | 默认值 | 说明 |
|-------|--------|------|
| checkin_min | 2 | 签到最小奖励（积分） |
| checkin_max | 3 | 签到最大奖励（积分） |
| invite_reward | 5 | 邀请奖励（积分/人） |
| query_cost | 5 | 用户查询费用（积分/次） |
| text_search_cost | 5 | 关键词搜索费用（积分/次） |
| recharge_min_amount | 10 | 最小充值金额（USDT） |
| recharge_timeout | 1800 | 充值订单超时（秒） |

---

## ⚠️ 注意事项

1. **API 密钥安全**
   - 不要泄露你的 API_HASH、BOT_TOKEN、QUERY_API_KEY
   - 不要将 .env 文件提交到 Git

2. **TRON 网络选择**
   - 测试时使用 `nile` 测试网
   - 生产环境使用 `mainnet` 主网
   - 主网和测试网的合约地址不同

3. **钱包地址安全**
   - 确保你拥有 RECHARGE_WALLET_ADDRESS 的私钥
   - 定期检查充值到账情况
   - 建议使用专用钱包地址

4. **性能优化**
   - 合理设置并发限制
   - 使用数据库缓存减少API调用
   - 定期清理过期数据

---

## 🔍 故障排查

### 问题1: Bot无法启动
- 检查 .env 文件是否正确配置
- 检查 API_ID、API_HASH、BOT_TOKEN 是否有效

### 问题2: 查询失败
- 检查 QUERY_API_KEY 是否正确
- 检查 QUERY_API_URL 是否可访问
- 查看日志文件了解详细错误

### 问题3: 充值无法到账
- 检查 TRON_NETWORK 配置
- 检查 RECHARGE_WALLET_ADDRESS 是否正确
- 查看日志中的区块扫描信息

---

## 📞 技术支持

如有问题，请查看日志文件或联系管理员。

**最后更新**: 2025-10-28

